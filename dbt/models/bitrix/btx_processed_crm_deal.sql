SELECT
   -- Primary identifiers
    "ID"::int4 as id,
    ("CONTENT"->>'TITLE')::varchar as title,
    case when SPLIT_PART(("CONTENT"->>'STAGE_ID')::varchar, ':', 2) = '' then ("CONTENT"->>'STAGE_ID')::varchar else SPLIT_PART(("CONTENT"->>'STAGE_ID')::varchar, ':', 2) end as stage_id,
    ("CONTENT"->>'STAGE_SEMANTIC_ID')::varchar as stage_semantic_id,
    ("CONTENT"->>'TYPE_ID')::varchar as type_id,
    NULLIF("CONTENT"->>'CATEGORY_ID', '')::int2 as category_id,
    
    -- Deal information
    NULLIF("CONTENT"->>'OPPORTUNITY', '')::numeric as opportunity,
    ("CONTENT"->>'PROBABILITY')::varchar as probability,
    ("CONTENT"->>'CURRENCY_ID')::varchar as currency_id,
    NULLIF("CONTENT"->>'TAX_VALUE', '')::numeric as tax_value,
    ("CONTENT"->>'LOCATION_ID')::varchar as location_id,
    ("CONTENT"->>'QUOTE_ID')::varchar as quote_id,
    
    -- Status flags
    NULLIF("CONTENT"->>'CLOSED', '[]')::bool as closed,
    NULLIF("CONTENT"->>'OPENED', '[]')::bool as opened,
    NULLIF("CONTENT"->>'IS_NEW', '[]')::bool as is_new,
    ("CONTENT"->>'IS_RECURRING')::bool as is_recurring,
    ("CONTENT"->>'IS_MANUAL_OPPORTUNITY')::bool as is_manual_opportunity,
    ("CONTENT"->>'IS_RETURN_CUSTOMER')::bool as is_return_customer,
    ("CONTENT"->>'IS_REPEATED_APPROACH')::bool as is_repeated_approach,
    
    -- Dates and timestamps
    NULLIF("CONTENT"->>'DATE_CREATE', '')::timestamptz as date_create,
    NULLIF("CONTENT"->>'DATE_MODIFY', '')::timestamptz as date_modify,
    NULLIF("CONTENT"->>'BEGINDATE', '')::timestamptz as begin_date,
    NULLIF("CONTENT"->>'CLOSEDATE', '')::timestamptz as close_date,
    NULLIF("CONTENT"->>'MOVED_TIME', '')::timestamptz as moved_time,
    NULLIF("CONTENT"->>'LAST_ACTIVITY_TIME', '')::timestamptz as last_activity_time,
    
    -- User references
    NULLIF("CONTENT"->>'ASSIGNED_BY_ID', '')::int2 as assigned_by_id,
    NULLIF("CONTENT"->>'MODIFY_BY_ID', '')::int2 as modify_by_id,
    NULLIF("CONTENT"->>'CREATED_BY_ID', '')::int2 as created_by_id,
    NULLIF("CONTENT"->>'MOVED_BY_ID', '')::int2 as moved_by_id,
    NULLIF("CONTENT"->>'LAST_ACTIVITY_BY', '')::int2 as last_activity_by,
    
    -- Related entities
    NULLIF("CONTENT"->>'COMPANY_ID', '')::int2 as company_id,
    NULLIF("CONTENT"->>'CONTACT_ID', '')::int2 as contact_id,
    ("CONTENT"->>'LEAD_ID')::varchar as lead_id,
    
    -- Source and origin
    ("CONTENT"->>'SOURCE_ID')::varchar as source_id,
    ("CONTENT"->>'SOURCE_DESCRIPTION')::text as source_description,
    ("CONTENT"->>'ORIGIN_ID')::varchar as origin_id,
    ("CONTENT"->>'ORIGINATOR_ID')::varchar as originator_id,
    
    -- UTM parameters
    ("CONTENT"->>'UTM_SOURCE')::varchar as utm_source,
    ("CONTENT"->>'UTM_MEDIUM')::varchar as utm_medium,
    ("CONTENT"->>'UTM_CAMPAIGN')::varchar as utm_campaign,
    ("CONTENT"->>'UTM_CONTENT')::varchar as utm_content,
    ("CONTENT"->>'UTM_TERM')::varchar as utm_term,
    
    -- Additional information
    ("CONTENT"->>'COMMENTS')::text as comments,
    ("CONTENT"->>'ADDITIONAL_INFO')::text as additional_info,
    
    -- Custom fields (UF_CRM)
    NULLIF("CONTENT"->>'UF_CRM_1718891707656', '')::int2 as uf_crm_1718891707656,
    ("CONTENT"->>'UF_CRM_1718893063318')::varchar as uf_crm_1718893063318,
    NULLIF("CONTENT"->>'UF_CRM_1718895613676', '')::int2 as uf_crm_1718895613676,
    NULLIF("CONTENT"->>'UF_CRM_1718895632531', '')::int2 as uf_crm_1718895632531,
    NULLIF("CONTENT"->>'UF_CRM_1718895837277', '')::int2 as uf_crm_1718895837277,
    ("CONTENT"->>'UF_CRM_1719234554494')::varchar as uf_crm_1719234554494,
    NULLIF("CONTENT"->>'UF_CRM_1719234611470', '')::int2 as uf_crm_1719234611470,
    NULLIF("CONTENT"->>'UF_CRM_1719234653377', '')::int2 as uf_crm_1719234653377,
    ("CONTENT"->>'UF_CRM_1719851689133')::varchar as uf_crm_1719851689133,
    ("CONTENT"->>'UF_CRM_1719851724735')::varchar as uf_crm_1719851724735,
    ("CONTENT"->>'UF_CRM_1719942627227')::jsonb as uf_crm_1719942627227,
    ("CONTENT"->>'UF_CRM_1720015348995')::jsonb as uf_crm_1720015348995,
    ("CONTENT"->>'UF_CRM_1720198477652')::varchar as uf_crm_1720198477652,
    ("CONTENT"->>'UF_CRM_1720198502628')::varchar as uf_crm_1720198502628,
    NULLIF("CONTENT"->>'UF_CRM_1721083795801', '')::int2 as uf_crm_1721083795801,
    NULLIF("CONTENT"->>'UF_CRM_1721083820061', '')::numeric as uf_crm_1721083820061,
    NULLIF("CONTENT"->>'UF_CRM_1721083836488', '')::numeric as uf_crm_1721083836488,
    NULLIF("CONTENT"->>'UF_CRM_1721083849804', '')::numeric as uf_crm_1721083849804,
    NULLIF("CONTENT"->>'UF_CRM_1721083861185', '')::numeric as uf_crm_1721083861185,
    NULLIF("CONTENT"->>'UF_CRM_1721083874978', '')::numeric as uf_crm_1721083874978,
    NULLIF("CONTENT"->>'UF_CRM_1721083894608', '')::numeric as uf_crm_1721083894608,
    NULLIF("CONTENT"->>'UF_CRM_1721083906720', '')::numeric as uf_crm_1721083906720,
    NULLIF("CONTENT"->>'UF_CRM_1721226126', '[]')::bool as uf_crm_1721226126,
    nullif("CONTENT"->>'UF_CRM_1721227124', '[]')::bool as uf_crm_1721227124,
    ("CONTENT"->>'UF_CRM_1721241190')::varchar as uf_crm_1721241190,
    ("CONTENT"->>'UF_CRM_1721243220370')::varchar as uf_crm_1721243220370,
    ("CONTENT"->>'UF_CRM_1721243302036')::varchar as uf_crm_1721243302036,
    NULLIF("CONTENT"->>'UF_CRM_1721243367', '[]')::bool as uf_crm_1721243367,
    ("CONTENT"->>'UF_CRM_1721244413245')::text as uf_crm_1721244413245,
    ("CONTENT"->>'UF_CRM_1721244451568')::text as uf_crm_1721244451568,
    ("CONTENT"->>'UF_CRM_1721244493157')::text as uf_crm_1721244493157,
    ("CONTENT"->>'UF_CRM_1721244526025')::text as uf_crm_1721244526025,
    NULLIF("CONTENT"->>'UF_CRM_1721244560622', '')::timestamptz as uf_crm_1721244560622,
    NULLIF("CONTENT"->>'UF_CRM_1721244826264', '')::int2 as uf_crm_1721244826264,
    ("CONTENT"->>'UF_CRM_1721244999810')::text as uf_crm_1721244999810,
    NULLIF("CONTENT"->>'UF_CRM_1721248388070', '')::int2 as uf_crm_1721248388070,
    NULLIF("CONTENT"->>'UF_CRM_1721248408791', '')::varchar as uf_crm_1721248408791,
    NULLIF("CONTENT"->>'UF_CRM_1721406278811', '')::timestamptz as uf_crm_1721406278811,
    NULLIF("CONTENT"->>'UF_CRM_1724261215', '')::numeric as uf_crm_1724261215,
    NULLIF("CONTENT"->>'UF_CRM_1724264534445', '')::numeric as uf_crm_1724264534445,
    ("CONTENT"->>'UF_CRM_1725574177266')::varchar as uf_crm_1725574177266,
    ("CONTENT"->>'UF_CRM_1725574322')::varchar as uf_crm_1725574322,
    NULLIF(BTRIM("CONTENT"->>'UF_CRM_1725548469220', '[]'), '')::timestamptz as uf_crm_1725548469220,
    ("CONTENT"->>'UF_CRM_1726002322164')::text as uf_crm_1726002322164,
    NULLIF("CONTENT"->>'UF_CRM_1726003734', '')::int2 as uf_crm_1726003734,
    NULLIF("CONTENT"->>'UF_CRM_1726007497', '')::numeric as uf_crm_1726007497,
    NULLIF("CONTENT"->>'UF_CRM_1728416073106', '')::numeric as uf_crm_1728416073106,
    ("CONTENT"->>'UF_CRM_1729086829554')::text as uf_crm_1729086829554,
    NULLIF("CONTENT"->>'UF_CRM_1729086887055', '')::timestamptz as uf_crm_1729086887055,
    NULLIF("CONTENT"->>'UF_CRM_1732567021643', '')::int2 as uf_crm_1732567021643,
    ("CONTENT"->>'UF_CRM_1733168617374')::text as uf_crm_1733168617374,
    ("CONTENT"->>'UF_CRM_1733491265514')::varchar as uf_crm_1733491265514,
    NULLIF("CONTENT"->>'UF_CRM_1738931838', '')::int2 as uf_crm_1738931838,
    NULLIF("CONTENT"->>'UF_CRM_1741275511723', '')::int2 as uf_crm_1741275511723,
    ("CONTENT"->>'UF_CRM_1741275566502')::varchar as uf_crm_1741275566502,
    ("CONTENT"->>'UF_CRM_1741275596050')::text as uf_crm_1741275596050,
    ("CONTENT"->>'UF_CRM_1741275610428')::varchar as uf_crm_1741275610428,
    NULLIF("CONTENT"->>'UF_CRM_1741275634394', '')::numeric as uf_crm_1741275634394,
    ("CONTENT"->>'UF_CRM_66D0A6A12E620')::text as uf_crm_66d0a6a12e620,
    ("CONTENT"->>'UF_CRM_66D0A6A146D20')::text as uf_crm_66d0a6a146d20,
    ("CONTENT"->>'UF_CRM_66D0A6A1529FD')::text as uf_crm_66d0a6a1529fd,
    ("CONTENT"->>'UF_CRM_66D0A6A15D94F')::text as uf_crm_66d0a6a15d94f,
    ("CONTENT"->>'UF_CRM_66D0A6A169EDC')::text as uf_crm_66d0a6a169edc,
    NULLIF("CONTENT"->>'UF_CRM_DEAL_1719236124580', '')::jsonb as uf_crm_deal_1719236124580,
    NULLIF("CONTENT"->>'UF_CRM_DEAL_1725540405848', '')::int2 as uf_crm_deal_1725540405848,
    NULLIF(NULLIF("CONTENT"->>'UF_CRM_DEAL_1725540759541', ''),'false')::jsonb as uf_crm_deal_1725540759541,
    ("CONTENT"->>'UF_CRM_DEAL_1725569571488')::text as uf_crm_deal_1725569571488,
    NULLIF("CONTENT"->>'UF_CRM_DEAL_1725569886689', '[]')::jsonb as uf_crm_deal_1725569886689,
    ("CONTENT"->>'UF_CRM_DEAL_1727374223411')::varchar as uf_crm_deal_1727374223411,
    ("CONTENT"->>'UF_CRM_DEAL_1727374263239')::varchar as uf_crm_deal_1727374263239,
    ("CONTENT"->>'UF_CRM_DEAL_1732567150103')::text as uf_crm_deal_1732567150103,
    ("CONTENT"->>'UF_CRM_DEAL_1738069738944')::varchar as uf_crm_deal_1738069738944,
    ("CONTENT"->>'UF_CRM_DEAL_1738069820827')::text as uf_crm_deal_1738069820827,
    ("CONTENT"->>'UF_CRM_DEAL_1722632496832')::varchar as uf_crm_deal_1722632496832,
    NULLIF("CONTENT"->>'UF_CRM_1744677619','')::int2 as uf_crm_1744677619
from {{ source('bitrix', 'btx_raw_deal') }}
WHERE "SUCCESS" = true